<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Identity Access</title>
    <link rel="stylesheet" href="index.css">
    <!--Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!--Icons -->
    <script src="https://kit.fontawesome.com/c3ebb3a7f0.js" crossorigin="anonymous"></script>



    <style>
        /* Custom responsive width classes based on Bootstrap's breakpoints */
        .w-xs-yidam {width: 70% !important}
        @media (min-width: 576px) { /* sm */
            .w-sm-yidam { width: 50% !important; }
        }
        @media (min-width: 768px) { /* md */
            .w-md-yidam { width: 35% !important; }
        }
        @media (min-width: 992px) { /* lg */
            .w-lg-yidam { width: 25% !important; }
        }
        @media (min-width: 1200px) { /* xl */
            .w-xl-yidam { width: 25% !important; }
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">

  </head>
  <body>
    <!-- <div class="screen-size-indicator d-block d-sm-none">XS Screen</div>
    <div class="screen-size-indicator d-none d-sm-block d-md-none">SM Screen</div>
    <div class="screen-size-indicator d-none d-md-block d-lg-none">MD Screen</div>
    <div class="screen-size-indicator d-none d-lg-block d-xl-none">LG Screen</div>
    <div class="screen-size-indicator d-none d-xl-block">XL Screen</div> -->

    <div class="yidam_image_container m-4">
      <img src="images/yidam_image.png" alt="yidam_image" class="mx-auto d-block w-xs-yidam w-sm-yidam w-md-yidam w-lg-yidam w-xl-yidam">
      <div class="text-center m-4" id="cipher_subtitle">
        <code>8OXG9pyv1NyowyojohT5oBmpAwg9FwB2F5sFSbhDVmJIam6MjHCuhddn5A4yV6To2p85mAGxRJUZTaKbq7aX98HNS70AXXnaWPURZo2HtIZNaX9tSFPxihNhNNK2b8gOg0rdg16ebmuLpX9/y+3SvQz95rkdf+tIpimG56xpWrE=</code>
      </div>
    </div>

    <div class="container">
      <div class="row">
          <div class="cipher_input_container col-10 offset-1 col-md-10 offset-md-1 mt-3 mb-3">
              <input type="text" class="form-control" id="cipher_input" placeholder="INPUT">
              <div class="d-flex justify-content-center mt-2">
                <button type="button" tabindex="-1" class="" onclick="validateCipher()" id="non_dualism_button">(advaita) (अद्वैत)</button>
              </div>
          </div>
          <div class="cipher_output_container col-10 offset-1 col-xs-8 offset-xs-2 col-md-10 offset-md-1 mb-3">
              <!-- <label for="cipher_output" class="text-center d-block">There could be a label here or not:</label> -->
              <textarea id="cipher_output" class="form-control" rows="1" readonly style="resize: none" placeholder="OUTPUT"></textarea>
              <button onclick="copyToClipboard()" id= 'copy-button' class="copy-button" disabled>
                <i class="fa-regular fa-copy"></i>
              </button>
              <div id="copy_confirm_text"></div>

          </div>
      </div>
    </div>
  <div id="bottom_padding"></div>

  <script>
    function copyToClipboard() {
        const textarea = document.getElementById('cipher_output');
        textarea.select();
        document.execCommand('copy');
        const confirmText = document.getElementById('copy_confirm_text');
        confirmText.innerText = "Copied to clipboard.";

        // Make the text disappear after 3 seconds
        setTimeout(() => {
            confirmText.innerText = '';
        }, 3000);
    }


    let LOCAL_TEST = 0;

    async function validateCipher() {
        const cipherInputText = document.getElementById('cipher_input').value;

        const bodyElement = document.body;
        const cipherInputElement = document.getElementById('cipher_input');
        const cipherSubtitleElement = document.getElementById('cipher_subtitle');
        const cipherSubtitleCodeElement = cipherSubtitleElement.querySelector('code');
        const non_dualism_button = document.getElementById('non_dualism_button');
        const cipherOutputElement = document.getElementById('cipher_output');
        const copyButton = document.getElementById('copy-button');

        bodyElement.style.transition = 'background-color 3s';
        cipherInputElement.style.transition = 'background-color 3s, color 3s';
        cipherSubtitleElement.style.transition = 'color 3s';
        cipherSubtitleCodeElement.style.transition = 'color 3s';
        non_dualism_button.style.transition = 'background-color 3s, color 3s';
        cipherOutputElement.style.transition = 'background-color 3s, color 3s';

        if (LOCAL_TEST === 0) {
            const response = await fetch('/.netlify/functions/validate-key', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ key: cipherInputText })
            });
            const data = await response.json();
            isValid = data.status === "success";
        }

        if (isValid) {
            cipherOutputElement.value = "Key is valid!";
            bodyElement.style.backgroundColor = '#26619c';

            cipherInputElement.style.backgroundColor = '#26619c';
            cipherInputElement.style.color = '#6790b9';

            cipherSubtitleElement.style.color = '#6790b9';
            cipherSubtitleCodeElement.style.color = '#6790b9';

            non_dualism_button.style.color = '#6790b9';
            non_dualism_button.style.backgroundColor = '#26619c';
            non_dualism_button.classList.add('btn-custom-color');

            cipherOutputElement.style.backgroundColor = '#26619c';
            cipherOutputElement.style.color = '#6790b9';

            cipherInputElement.classList.add("hover-outline");
            cipherSubtitleElement.classList.add("hover-outline");
            non_dualism_button.classList.add("hover-outline");
            cipherOutputElement.classList.add("hover-outline");

            copyButton.disabled = false;
            non_dualism_button.disabled = true;

        } else {
            cipherOutputElement.value = "Invalid key!";
        }
    }

    </script>
  </body>
</html>
